(()=>{var i=new URL(window.location.href),m=e=>new URL(e,i.origin),P=(e,t)=>m(e).searchParams.has(t),u=(e,t)=>m(e).searchParams.get(t),M=(e,t)=>!!u(e,t),f=e=>{let t=m(e);return new URLSearchParams(t.search)},O=(e,t=[])=>{let r=m(e),a=[...new URLSearchParams(r.search)].filter(([n])=>t.some(c=>n===c));return new URLSearchParams(a)},g=(e,t=[])=>{let r=m(e);return t.forEach(([o,a])=>{r.searchParams.set(o,a)}),r},V=(e,t=[])=>{let r=m(e);return[...typeof t=="string"?[t]:t].forEach(o=>{r.searchParams.delete(o)}),r};var v=["utm_source","utm_medium","utm_campaign","utm_content","utm_term"],T=["id"],k=["sb_id","sbid"],me=["page","show"],L={offerSettings:["/pl/sales/offer/update","/pl/sales/offer/create"],userDealsPage:["/sales/control/userProduct/my"],cms:{editor:["/pl/cms/page"]}},_=L.offerSettings.some(e=>i.pathname.includes(e)),R=L.userDealsPage.some(e=>i.pathname.includes(e)),D=L.cms.editor.some(e=>i.pathname.includes(e))||P(i.href,"editMode"),w=window.self!==window.top,q=me.some(e=>window?.controllerId===e),S="data-recode-value-set",I={full:!0,clean:!1},{isAdmin:ue,isTeacher:fe}=window.userInfo,N=ue||fe;var x={"location.href":"current-window","window.open":"new-window"},he={"new-window":e=>window.open(e,"_blank"),"current-window":e=>{w?window.top.location.href=e:window.location.href=e}},E=(e,t)=>{let r=m(e),o=he[t];o(r)},W=(e,t)=>{let r=document.createElement(e);return t&&r.classList.add(t),r},H=(e,t)=>k.some(o=>t===o)?M(e,t):!0;var z=e=>e.reduce((t,r)=>{if(r?.id&&(r?.type?.toLowerCase()==="user"||r?.type?.toLowerCase()==="deal")){let o=`formParams[${r.type.toLowerCase()}CustomFields][${r.id}]`;t.push({name:o,title:r.title,fieldSelector:`[name="${o}"]`,valueType:r.valueType,trigger:r.trigger})}return t},[]),j=e=>e.filter(({name:t})=>t.includes("userCustomFields")),G=e=>e.filter(({valueType:t,trigger:r})=>t==="param"&&r),Q=e=>e.filter(({valueType:t,trigger:r})=>t==="cookie"&&r),Z=e=>e.filter(({valueType:t,trigger:r})=>t==="other"&&r);var pe=e=>{let t=j(e),r=(s,d)=>{let l=document.createElement("input");return d&&l.setAttribute("data-field-title",d),l.setAttribute("name",s),l.setAttribute("type","hidden"),l},o=()=>{let s=W("div");return s.setAttribute("data-for","recode-analytic-fields"),s.setAttribute("data-author","recode studio (tg: @recode_solutions)"),s},a=(s,d)=>d.filter(({title:l,fieldSelector:h,trigger:p})=>!(s.querySelector(h)||s.querySelector(`[data-field-title="${l}"]`))&&H(i,p)),n=(s,d,l)=>{let h=a(s,l),p=o();h.forEach(({name:C,title:A})=>{p.appendChild(r(C,A)),s.querySelector(d)?s.querySelector(d).appendChild(p):s.appendChild(p)})};(()=>{document.querySelectorAll("form.lt-form").forEach(s=>{s.querySelector('[name="formParams[offer_id][]"]')||s.closest(".need-create-deal")||s.closest(".recode-form-create-deal")?n(s,".builder",e):n(s,".builder",t)})})()},B=pe;var ge={getValue:e=>{try{return decodeURIComponent(document.cookie.match(new RegExp(`(?:^|; )${e.replace(/([.$?*|{}()[]\\\/\+^])/g,"\\$1")}=([^;]*)`))[1])}catch{return}}},{getValue:Se}=ge,U=Se;var we=e=>{let t=`recode-${e}-`,r=n=>{let c=[...n.classList].find(s=>s.startsWith(t));return c?c.match(new RegExp(`${t}([^\\s]+)`))[1]:null},o=n=>{switch(e){case"value":case"text":return r(n);case"param":return u(i.href,r(n));case"cookie":return U(r(n));default:return null}};[...document.querySelectorAll(`[class*="${t}"]`)].filter(n=>[...n.classList].some(c=>c.startsWith(t))).forEach(n=>{let c=o(n);if(!c)return;e==="text"&&(c=c.replace(/[-_]/g," "));let s=n.querySelector(".form-control");!s||!(s.tagName==="INPUT"||s.tagName==="TEXTAREA")||(s.value=c)})},y=we;var X=document.referrer||"none",ye=P(i.href,"loc")?new URL(u(i.href,"loc")).href:i.href,J="user",K=e=>{let t=m(e),r=O(t.href,["id"]);return r.toString()?`${t.origin}${t.pathname}?${r}`:`${t.origin}${t.pathname}`},Y=w?K(i.href):"none",ee=()=>{let e={timeZone:"Europe/Moscow",day:"numeric",month:"numeric",year:"numeric"},t=new Date().toLocaleString("ru-RU",e),[r,o,a]=t.split(".").map(Number),n=r<10?`0${r}`:r,c=o<10?`0${o}`:o;return`${n}.${c}.${a}`},te=()=>{let e={timeZone:"Europe/Moscow",hour:"numeric"},t=Number(new Date().toLocaleString("ru-RU",e));return t>=0&&t<6?"\u041D\u043E\u0447\u044C":t>=6&&t<12?"\u0423\u0442\u0440\u043E":t>=12&&t<18?"\u0414\u0435\u043D\u044C":t>=18&&t<=23?"\u0412\u0435\u0447\u0435\u0440":""},re=()=>{let e=window.matchMedia("(max-width: 767px)"),t=window.matchMedia("(min-width: 768px) and (max-width: 1023px)");return e.matches?"\u041C\u043E\u0431\u0438\u043B\u044C\u043D\u043E\u0435 \u0443\u0441\u0442\u0440\u043E\u0439\u0441\u0442\u0432\u043E":t.matches?"\u041F\u043B\u0430\u043D\u0448\u0435\u0442":"\u041F\u041A"},$=e=>{let t=new URL(w?ye:i.href),r=K(t.href);return I[e]?t.href:r||"none"};var Pe=e=>{switch(e){case"referrer":return X;case"url_full":return $("full");case"url_clean":return $("clean");case"created_date":return ee();case"part_of_day":return te();case"created_type":return J;case"widget_url":return Y;case"device_type":return re();case"script_completed":return"1";default:return null}},Ee=(e,t)=>{switch(e){case"param":return u(i.href,t);case"cookie":return U(t);case"other":return Pe(t);default:return null}},Ue=e=>{let t=()=>{e.forEach(({fieldSelector:r,valueType:o,trigger:a})=>{document.querySelectorAll(`${r}:not([${S}])`).forEach(n=>{let c=n;c.value=Ee(o,a)??"",c.setAttribute(S,"")})})};t(),setInterval(()=>{t()},1e3)},b=Ue;var be=e=>{let t=[{elementSelector:"a[href]",elementAttributeLink:"href"}],r=(a,n)=>{[...document.querySelectorAll(`${a}:not([${S}])`)].filter(c=>/^(https?:\/)?\/.+/i.test(c.getAttribute(n))).forEach(c=>{let s=c.getAttribute(n);v.filter(le=>[...f(s).keys()].some(de=>le===de)).length>e.length&&(s=V(s,v).href),s=g(s,e);let{href:l,origin:h,pathname:p,search:C,hash:A}=s;c.setAttribute(n,window.location.origin===h?`${p}${C}${A}`:l),c.setAttribute(S,"")})},o=()=>{t.forEach(({elementSelector:a,elementAttributeLink:n})=>r(a,n,e))};o(e),setInterval(()=>{o(e)},1e3)},oe=be;var se=(e,t)=>{if(!e)throw new Error("RE-CODE STUDIO. \u041F\u043B\u0430\u0433\u0438\u043D gcModuleAnalytics. \u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D \u0430\u0434\u0440\u0435\u0441 \u0434\u043B\u044F \u0440\u0435\u0434\u0438\u0440\u0435\u043A\u0442\u0430");E(g(e,[...f(i.href)]).href,t)};var Fe=()=>{let e=".recode-transfer-params";document.querySelectorAll(e).forEach(t=>{let r=t.querySelector("button"),o=t.querySelector("script");if(!r||!o)return;let a=o.innerHTML.match(/(?:location\.href\s*=\s*['"]([^'"]+)['"]|window\.open\s*\(\s*['"]([^'"]+)['"])/);if(!a)return;let n={method:a[1]?x["location.href"]:x["window.open"],value:a[1]||a[2]||""},c=r.cloneNode(!0);r.parentNode.replaceChild(c,r),c.addEventListener("click",s=>{s.preventDefault(),E(g(n.value,[...f(i.href)]).href,n.method)})})},ae=Fe;var Ce=()=>{let e=o=>{let a=o;a.value=a.value.trim()},t=o=>{let a=document.createElement("p");return a.classList.add("warning"),a.style.cssText+="color: #cc3300;",o&&(a.innerHTML=o),a},r=()=>{let o=document.querySelector("#offer-code"),a=u(i.href,"id");if(!(o&&a)||o.value===a)return;let n=t();o.before(n),o.value?Number.isNaN(Number(o.value))?n.innerHTML=`
      \u041B\u0443\u0447\u0448\u0435 \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u0432 \u044D\u0442\u043E\u043C \u043F\u043E\u043B\u0435 ID \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u044F \u0438\u0437 URL \u2014 <strong>${a}</strong>. \u041D\u043E \u0441\u043D\u0430\u0447\u0430\u043B\u0430 \u043D\u0443\u0436\u043D\u043E \u0443\u0431\u0435\u0434\u0438\u0442\u044C\u0441\u044F, \u0447\u0442\u043E \u0434\u0430\u043D\u043D\u044B\u0439 \u0438\u0434\u0435\u043D\u0442\u0438\u0444\u0438\u043A\u0430\u0442\u043E\u0440 \u043D\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0433\u0434\u0435-\u0442\u043E \u0432 \u0434\u0440\u0443\u0433\u043E\u043C \u043C\u0435\u0441\u0442\u0435 \u043D\u0430 \u043F\u043B\u0430\u0442\u0444\u043E\u0440\u043C\u0435 \u0438\u043B\u0438 \u043F\u0440\u0438 \u0438\u043D\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u0438 \u0441 API
      `:(n.innerHTML=`
      \u0423\u043D\u0438\u043A\u0430\u043B\u044C\u043D\u044B\u0439 \u0438\u0434\u0435\u043D\u0442\u0438\u0444\u0438\u043A\u0430\u0442\u043E\u0440 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u044F \u0438\u0437\u043C\u0435\u043D\u0435\u043D c <strong>${o.value}</strong> \u043D\u0430 <strong>${a}</strong>. \u041D\u0435 \u0437\u0430\u0431\u0443\u0434\u044C\u0442\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F
      `,o.value=a):(o.value=a,n.innerHTML="\u0423\u043D\u0438\u043A\u0430\u043B\u044C\u043D\u044B\u0439 \u0438\u0434\u0435\u043D\u0442\u0438\u0444\u0438\u043A\u0430\u0442\u043E\u0440 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u044F \u0438\u0437\u043C\u0435\u043D\u0435\u043D. \u041D\u0435 \u0437\u0430\u0431\u0443\u0434\u044C\u0442\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F")};document.querySelectorAll("#offer-title, #offer-code, #paramsobject-after_payment_redirect_url, #paramsobject-form_title").forEach(o=>{e(o),o.addEventListener("change",()=>e(o))}),r()},ne=Ce;var Ae=(e,t)=>{if(N&&!t)return;let r=a=>{let n=document.querySelectorAll(".main-page-block > .container > table > tbody > tr"),c=a.toLowerCase();n.forEach(s=>{[...s.querySelectorAll("td")].find(h=>h.innerText.toLowerCase().includes(c))&&s.classList.add("hide")})};e.forEach(a=>r(a)),(()=>{let a=["\u041D\u0435\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043D\u044B\u0435 \u0437\u0430\u043A\u0430\u0437\u044B","\u041A\u0443\u043F\u043B\u0435\u043D\u043D\u044B\u0435 \u043F\u0440\u043E\u0434\u0443\u043A\u0442\u044B","\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043D\u044B\u0435 \u0437\u0430\u043A\u0430\u0437\u044B"];[...document.querySelectorAll("h3")].filter(c=>a.some(s=>c.textContent.trim()===s)).forEach(c=>{let s=c.nextElementSibling;!s?.classList.contains("table")||[...s.querySelectorAll("tbody > tr")].some(l=>!l.classList.contains("hide"))||(s.classList.add("hide"),c.classList.add("hide"))})})()},ce=Ae;var ve={redirectMode:"new-window",hideSystemOrders:{searchWords:["\u0422\u0435\u0441\u0442","\u0427\u0435\u043A\u0438\u043D","\u0417\u0430\u044F\u0432\u043A\u0430","\u0422\u0430\u0431\u043B\u0438\u0446\u0430","\u0412\u043E\u0440\u043E\u043D\u043A\u0430","\u0412\u0435\u0431\u0438\u043D\u0430\u0440","\u0422\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A","\u0421\u0438\u0441\u0442\u0435\u043C\u043D\u044B\u0439","\u041F\u0440\u0435\u0434\u0441\u043F\u0438\u0441\u043E\u043A","\u041F\u0440\u0435\u0434\u0437\u0430\u043F\u0438\u0441\u044C","\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F","\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F","systemic_","[systemic]"],hideFromEmpoyees:!0}},F=ve;var Le=e=>({fields:e?.fields??[],redirectMode:e?.redirectMode||F.redirectMode,hideSystemOrders:{searchWords:e?.hideSystemOrders?.searchWords||F.hideSystemOrders.searchWords,hideFromEmpoyees:e?.hideSystemOrders?.hideFromEmpoyees||F.hideSystemOrders.hideFromEmpoyees}}),ie=Le;window.recode={...window.recode||{},gcModuleAnalytics:{init(e={}){if(this.config)throw new Error("RE-CODE STUDIO. \u041F\u043B\u0430\u0433\u0438\u043D gcModuleAnalytics. \u041F\u043E\u0432\u0442\u043E\u0440\u043D\u0430\u044F \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u043E\u043D\u0430\u043B\u0430 \u043D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u0430");this.config=ie(e);let t=z(this.config.fields),r=G(t),o=Q(t),a=Z(t);B(t),b(a),y("value"),y("text"),ae(),document.cookie&&(y("cookie"),b(o));let n=f(i.href),c=[...n],s=[...n].filter(([d])=>!T.some(l=>l===d));c.length&&(y("param"),b(r)),!D&&q&&s.length&&oe(s),_&&ne(),R&&ce(this.config.hideSystemOrders.searchWords,this.config.hideSystemOrders.hideFromEmpoyees)},redirectWithSearchParams(e,t=this.config.redirectMode){se(e,t)}}};})();
